<mat-card class="mb-25 tagus-card">
  <mat-card-header>
      <h5 class="mb-0">HTML Generator</h5>
  </mat-card-header>
  <br/>
  <mat-card-content>
    <div class="row">
      
      <div class="col-xl-12" *ngIf="iframeSrc"> 
        <h6 class="section-heading">Main Layout</h6>
        <div class="controls-bar">
          <div class="control-group theme-controls">
            <div class="control-label">Theme</div>
            <mat-button-toggle-group [value]="theme" (change)="setTheme($event.value)" name="theme" aria-label="Theme selection">
              <mat-button-toggle value="dark"><span class="theme-indicator" style="background-color: #000;"></span>Dark</mat-button-toggle>
              <mat-button-toggle value="light"><span class="theme-indicator" style="background-color: #fff; border: 1px solid #d1d5db;"></span>Light</mat-button-toggle>
              <mat-button-toggle value="blue"><span class="theme-indicator" style="background-color: #0f4c81;"></span>Blue</mat-button-toggle>
              <mat-button-toggle value="red"><span class="theme-indicator" style="background-color: #b91c1c;"></span>Red</mat-button-toggle>
              <mat-button-toggle value="gold"><span class="theme-indicator" style="background-color: #FFD700;"></span>Gold</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
          <div class="control-group text-controls">
            <div class="control-label">Text</div>
            <mat-button-toggle-group [value]="textColorMode" (change)="setTextColor($event.value)" name="textColor" aria-label="Text color">
              <mat-button-toggle value="auto"><span class="text-indicator" style="background: linear-gradient(90deg,#fff 0%, #000 100%);"></span>Auto</mat-button-toggle>
              <mat-button-toggle value="dark"><span class="text-indicator" style="background-color: #000;"></span>Dark</mat-button-toggle>
              <mat-button-toggle value="light"><span class="text-indicator" style="background-color: #fff; border: 1px solid #d1d5db;"></span>Light</mat-button-toggle>
              <mat-button-toggle value="gold"><span class="text-indicator" style="background-color: #FFD700;"></span>Gold</mat-button-toggle>
              <mat-button-toggle value="red"><span class="text-indicator" style="background-color: #b91c1c;"></span>Red</mat-button-toggle>
            </mat-button-toggle-group>
          </div>
          
          <div class="control-group background-group">
            <div class="control-label">Background</div>
            <div class="upload-group">
              <button mat-stroked-button color="primary" (click)="bgFile.click()">
                <mat-icon>image</mat-icon>
                Add Image
              </button>
              <span *ngIf="bgFileName" class="file-name">{{ bgFileName }}</span>
              <button mat-icon-button *ngIf="bgFileName" aria-label="Clear background" (click)="clearBackground()">
                <mat-icon>close</mat-icon>
              </button>
              <input #bgFile type="file" accept="image/*" (change)="uploadBackground($event)" hidden />
            </div>
          </div>
          <h6 class="section-heading">Menu Layouts</h6>
          <div class="editor-group">
            <mat-stepper orientation="horizontal">
              <!-- Home section first -->
              <mat-step>
                <ng-template matStepLabel>{{ homeSection.menuTitle }}</ng-template>
                <ng-template matStepContent>
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Home Section Name</mat-label>
                    <input matInput [(ngModel)]="homeSection.menuTitle"/>
                  </mat-form-field>
                  <html-steppers 
                    [SectionHeader]="homeSection.menuTitle"
                    [SectionName]="homeSection.sectionName" 
                    [textColor]="getThemeColors(theme).fg"
                    [columnsCount]="homeSection.columnsCount"
                    [bgImgURLInput]="homeSection.bgImgURL"
                    (TextToUpdateIFrame)="appendSectionHtml($event)">
                  </html-steppers>
                </ng-template>
              </mat-step>

              <!-- Remaining sections -->
              <mat-step *ngFor="let section of sections">
                <ng-template matStepLabel>{{ section.menuTitle }}</ng-template>
                <ng-template matStepContent>
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Section Name</mat-label>
                    <input matInput [(ngModel)]="section.menuTitle"/>
                  </mat-form-field>
                  <html-steppers 
                    [SectionHeader]="section.sectionHeader"
                    [SectionName]="section.sectionName" 
                    [textColor]="getThemeColors(theme).fg"
                    [columnsCount]="section.columnsCount"
                    [bgImgURLInput]="section.bgImgURL"
                    (TextToUpdateIFrame)="appendSectionHtml($event)">
                  </html-steppers>
                </ng-template>
              </mat-step>
            </mat-stepper>
          </div>
        </div>
        <div class="preview-card">
          <div class="preview-header">HTML Preview</div>
          <iframe [src]="iframeSrc" class="preview-frame"></iframe>
        </div>
      </div>
    </div> 

    

    <mat-accordion *ngIf="iframeSrc" class="code-card">
      <mat-expansion-panel>
        <mat-expansion-panel-header>
          <mat-panel-title>Generated HTML</mat-panel-title>
        </mat-expansion-panel-header>
        <pre class="code-block">{{ generatedHtml }}</pre>
        <div class="preview-actions">
          <button mat-flat-button color="primary" [disabled]="!generatedHtml" (click)="downloadHtml()">
            <mat-icon>download</mat-icon>
            Download HTML
          </button>
        </div>
      </mat-expansion-panel>
    </mat-accordion>
    
  </mat-card-content>
</mat-card>
